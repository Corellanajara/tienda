<?php

/* Carrito/index.js.twig */
class __TwigTemplate_a743af2c6d05da1ad7e43aa8e13390618bec4adec05e46ac5fc9e74f49ca2a47 extends Twig_Template
{
    public function __construct(Twig_Environment $env)
    {
        parent::__construct($env);

        $this->parent = false;

        $this->blocks = array(
        );
    }

    protected function doDisplay(array $context, array $blocks = array())
    {
        // line 1
        echo "<script type=\"text/javascript\" src=\"";
        echo twig_escape_filter($this->env, $this->getAttribute((isset($context["app"]) ? $context["app"] : null), "path"), "html", null, true);
        echo "/";
        echo twig_escape_filter($this->env, (isset($context["theme"]) ? $context["theme"] : null), "html", null, true);
        echo "/js/jquery-1.8.2.min.js\"></script> ";
        // line 2
        echo "<script src=\"";
        echo twig_escape_filter($this->env, $this->getAttribute((isset($context["app"]) ? $context["app"] : null), "path"), "html", null, true);
        echo "/";
        echo twig_escape_filter($this->env, (isset($context["theme"]) ? $context["theme"] : null), "html", null, true);
        echo "/js/modernizr.custom.12319.js\"></script> ";
        // line 3
        echo "<!-- JQUERY UI -->
<script src=\"http://code.jquery.com/ui/1.10.3/jquery-ui.js\"></script> <!-- jQuery UI -->  
<script src=\"";
        // line 5
        echo twig_escape_filter($this->env, $this->getAttribute((isset($context["app"]) ? $context["app"] : null), "path"), "html", null, true);
        echo "/";
        echo twig_escape_filter($this->env, (isset($context["theme"]) ? $context["theme"] : null), "html", null, true);
        echo "/js/albatronic.js\"></script>

<!-- SLIDER HOME -->
<script src=\"";
        // line 8
        echo twig_escape_filter($this->env, $this->getAttribute((isset($context["app"]) ? $context["app"] : null), "path"), "html", null, true);
        echo "/";
        echo twig_escape_filter($this->env, (isset($context["theme"]) ? $context["theme"] : null), "html", null, true);
        echo "/js/bjqs-1.3.min.js\"></script>
<script src=\"";
        // line 9
        echo twig_escape_filter($this->env, $this->getAttribute((isset($context["app"]) ? $context["app"] : null), "path"), "html", null, true);
        echo "/";
        echo twig_escape_filter($this->env, (isset($context["theme"]) ? $context["theme"] : null), "html", null, true);
        echo "/js/bjqs-function.js\"></script>
<script src=\"";
        // line 10
        echo twig_escape_filter($this->env, $this->getAttribute((isset($context["app"]) ? $context["app"] : null), "path"), "html", null, true);
        echo "/";
        echo twig_escape_filter($this->env, (isset($context["theme"]) ? $context["theme"] : null), "html", null, true);
        echo "/js/jcarousellite.js\" type=\"text/javascript\"></script>
<script src=\"//use.edgefonts.net/open-sans.js\"></script>
<script>
var combinaciones = ";
        // line 13
        echo $this->getAttribute((isset($context["values"]) ? $context["values"] : null), "combinacionesJSON");
        echo ";

\$(function(){
    
    // Validar que las condiciones de compra estén aceptadas
    \$('#botonRealizarPedido').click(function(){
        if (\$('#zonaEnvio').val() === '0') {
            \$('#mensajes').html('";
        // line 20
        echo twig_escape_filter($this->env, $this->getAttribute((isset($context["macro"]) ? $context["macro"] : null), "idioma", array(0 => "debeIndicarZonaEnvio"), "method"), "html", null, true);
        echo "');
            \$('#mensajes').dialog('open');            
            return false;            
        }
        if (\$('#formaPago').val() === '0') {
            \$('#mensajes').html('";
        // line 25
        echo twig_escape_filter($this->env, $this->getAttribute((isset($context["macro"]) ? $context["macro"] : null), "idioma", array(0 => "debeIndicarFormaPago"), "method"), "html", null, true);
        echo "');
            \$('#mensajes').dialog('open');            
            return false;            
        }
        if (\$('#metodoEnvio').val() === '0') {
            \$('#mensajes').html('";
        // line 30
        echo twig_escape_filter($this->env, $this->getAttribute((isset($context["macro"]) ? $context["macro"] : null), "idioma", array(0 => "debeIndicarFormaEnvio"), "method"), "html", null, true);
        echo "');
            \$('#mensajes').dialog('open');            
            return false;            
        }
        if (!\$('#condiciones').is(':checked')) {
            \$('#mensajes').html('";
        // line 35
        echo twig_escape_filter($this->env, $this->getAttribute((isset($context["macro"]) ? $context["macro"] : null), "idioma", array(0 => "debeAceptarCondiciones"), "method"), "html", null, true);
        echo "');
            \$('#mensajes').dialog('open');            
            return false;
        }
        
        return true;
    });
    
    \$(\"#mensajes\").dialog({
        autoOpen: false,
        width: 340,
        //height: 420,
        position: ['center','center'],
        closeOnEscape: true,
        modal: true,
        resizable: false,
        dialogClass: \"no-close\",
        buttons: [
            {
                text: \"";
        // line 54
        echo twig_escape_filter($this->env, $this->getAttribute((isset($context["macro"]) ? $context["macro"] : null), "idioma", array(0 => "cerrar"), "method"), "html", null, true);
        echo "\",
                click: function() {\$( this ).dialog( \"close\" );}
            }
       ]        
    }
    );
    
    \$('#zonaEnvio').change(function(){
        html = \"<option value='0'></option>\";
        zona = \$('#zonaEnvio').val();
        fp = \"\";        
        \$.each(combinaciones[zona],function(key,value){
            if (key !== '0') {
                formaPago = value['0'];
                html = html + \"<option value=\"+key+\">\"+formaPago+\"</option>\";                    
            }
        });
        \$('#formaPago option').remove();
        \$('#formaPago').append(html);
        \$('#formaPago').change();
    });
    
    \$('#formaPago').change(function(){
        html = \"<option value='0'></option>\";
        zona = \$('#zonaEnvio').val();
        fp = \$('#formaPago').val();  
        if (fp !== '0') {
            \$.each(combinaciones[zona][fp],function(key,value){
                if (key !== '0') {
                    html = html + \"<option value=\"+key+\">\"+value.agencia+\"</option>\"; 
                }
            });
        }
        \$('#metodoEnvio option').remove();
        \$('#metodoEnvio').append(html);
        \$('#metodoEnvio').change();
    });
    
    \$('#metodoEnvio').change(function(){
        zona = \$('#zonaEnvio').val();
        fp = \$('#formaPago').val(); 
        if (zona !=='0' && fp !== '0' && \$(this).val() !== '0') {
            gastos = combinaciones[zona][fp][\$(this).val()]['gastos'];
            plazoEntrega = combinaciones[zona][fp][\$(this).val()]['plazoEntrega'];
        } else {
            gastos = '0';
            plazoEntrega = '';
        }
        updateGastos(gastos,plazoEntrega);       
    });
    
    \$('#aplicarCupon').click(function(){

        var datos = {
            'cupon' : \$(\"#codigoCupon\").val()
        };

        \$.ajax({
            url: appPath + '/lib/cupon.php',
            dataType: 'html',
            type: 'post',
            data: {'parametros': {'accion': 'valida', 'datos': datos} },
            success: function(resultado) {
                var datos = \$.parseJSON(resultado);  
                if (datos.status === 'error') {
                    \$(\"#descripcionCupon\").html(\"\");
                    \$('#mensajes').html(datos.errores);
                    \$('#mensajes').dialog('open');
                } else {
                    \$(\"#boxCupon\").removeClass('oculta');
                    \$(\"#descripcionCupon\").html(datos.cupon.mensaje);
                }
            }
        });        
    });
});

/**
 * Refresca los texto de gastos y plazo de entrega
 * @param string gastos
 * @param string plazoEntrega
 * @returns void
 */
function updateGastos(gastos,plazoEntrega) {

    \$('#gastosEnvio').html(gastos);
    \$('#plazoEntrega').html(plazoEntrega);
    
    var datos = {
        'zonaEnvio': \$('#zonaEnvio').val(), 
        'formaPago': \$('#formaPago').val(), 
        'formaEnvio':\$('#metodoEnvio').val(),
        'gastosEnvio' : gastos,
        'plazoEntrega' : plazoEntrega
    };
    
    // Actualizar la sesion
    \$.ajax({
        url: appPath + '/lib/updateSesion.php',
        dataType: 'html',
        type: 'post',
        data: datos,
        success: function(resultado) {
            var datos = \$.parseJSON(resultado);
            aux = \$('#subtotal').html().replace(\",\",\".\");
            total = parseFloat(aux) + parseFloat(gastos);
            \$('#total').html(total);            
        }
    });     
}

/**
 * Actualiza la línea de carrito idLinea
 * @param integer idLinea
 * @returns void
 */
function actualizar(idLinea) {
    if (\$('#unidades'+idLinea).val()<=0) return;

    var datos = {
        'IDLinea' : idLinea,
        'Unidades' : \$('#unidades'+idLinea).val()
    };

    \$.ajax({
        url: appPath + '/lib/carrito.php',
        dataType: 'html',
        type: 'post',
        data: {'parametros': {'accion': 'update', 'datos': datos} },
        success: function(resultado) {
            var datos = \$.parseJSON(resultado);  
            if (datos.status === 'error') {
                \$('#mensajes').html(datos.errores);
                \$('#mensajes').dialog('open');
            } else {
                \$('#importe'+idLinea).html(datos.linea.Importe);
                \$('#subtotal').html(datos.totales.Importe);
                \$('#gastosEnvio').html(datos.totales.gastosEnvio);
                \$('#total').html(datos.totales.total);
            }
        }
    });        
}

/**
 * Elimina la línea del carrito idLinea
 * @param integer idLinea
 * @returns void
 */
function eliminar(idLinea) {
    if (!confirm('";
        // line 204
        echo twig_escape_filter($this->env, $this->getAttribute((isset($context["macro"]) ? $context["macro"] : null), "idioma", array(0 => "deseaEliminarDeLaCestaElProducto"), "method"), "html", null, true);
        echo "')) return;

    var datos = {
        'IDLinea' : idLinea
    };

    \$.ajax({
        url: appPath + '/lib/carrito.php',
        dataType: 'html',
        type: 'post',
        data: {'parametros': {'accion': 'remove', 'datos': datos} },
        success: function(resultado) {
            var datos = \$.parseJSON(resultado);  
            if (datos.status === 'error') {
                \$('#mensajes').html(datos.errores);
                \$('#mensajes').dialog('open');
            } else {
                \$('#linea'+idLinea).remove();
                if (datos.totales.Unidades !== null) {
                    \$('#subtotal').html(datos.totales.Importe);
                    \$('#gastosEnvio').html(datos.totales.gastosEnvio);
                    \$('#total').html(datos.totales.total);
                } else {
                    window.location.href = \"";
        // line 227
        echo twig_escape_filter($this->env, $this->getAttribute((isset($context["app"]) ? $context["app"] : null), "path"), "html", null, true);
        echo "/carrito\";                        
                }
            }
        }
    });         
}

</script>";
    }

    public function getTemplateName()
    {
        return "Carrito/index.js.twig";
    }

    public function isTraitable()
    {
        return false;
    }

    public function getDebugInfo()
    {
        return array (  298 => 227,  272 => 204,  119 => 54,  97 => 35,  89 => 30,  81 => 25,  73 => 20,  63 => 13,  55 => 10,  49 => 9,  43 => 8,  35 => 5,  31 => 3,  25 => 2,  19 => 1,);
    }
}

